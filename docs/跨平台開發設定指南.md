# 跨平台開發設定指南

本指南涵蓋 Windows、Linux (WSL) 和 macOS 之間常見的開發環境設定問題與解決方案。

## 目錄

- [Git 設定](#git-設定)
- [行尾符號處理](#行尾符號處理)
- [文件編碼](#文件編碼)
- [VS Code 進階設定](#vs-code-進階設定)
- [路徑處理](#路徑處理)
- [環境變數](#環境變數)
- [腳本執行](#腳本執行)
- [Python 開發](#python-開發)
- [Node.js 開發](#nodejs-開發)
- [最佳實踐](#最佳實踐)

---

## Git 設定

### 1. 文件權限處理

**問題**: Windows 不支援 Unix 文件權限,導致 Git 顯示大量權限變更。

**解決方案**:

```bash
# 忽略文件權限變更 (推薦在 Windows 上設定)
git config core.filemode false

# 全域設定
git config --global core.filemode false
```

### 2. 行尾符號自動轉換

**問題**: Windows 使用 CRLF (`\r\n`),Unix/Linux 使用 LF (`\n`),可能導致文件被視為已修改。

**解決方案**:

```bash
# Windows: 自動轉換 (checkout 時 LF→CRLF, commit 時 CRLF→LF)
git config --global core.autocrlf true

# Linux/macOS: 只在 commit 時將 CRLF 轉為 LF
git config --global core.autocrlf input

# 完全不轉換 (需搭配 .gitattributes)
git config --global core.autocrlf false
```

### 3. 長路徑支援 (Windows)

**問題**: Windows 預設路徑長度限制為 260 字元。

**解決方案**:

```bash
# 啟用長路徑支援
git config --global core.longpaths true
```

### 4. 大小寫敏感度

**問題**: Windows 文件系統不分大小寫,但 Git 預設區分大小寫。

**解決方案**:

```bash
# 檢查當前設定
git config core.ignorecase

# 在 Windows 上設為 true (通常是預設值)
git config core.ignorecase true

# 重命名文件 (大小寫變更)
git mv --force oldname.txt OldName.txt
```

### 5. 全域 .gitignore

**建議設定**:

```bash
# 設定全域 gitignore 文件
git config --global core.excludesfile ~/.gitignore_global
```

**全域 .gitignore 內容範例**:

```gitignore
# OS 相關
.DS_Store          # macOS
Thumbs.db          # Windows
Desktop.ini        # Windows
*~                 # Linux 備份檔

# IDE 相關
.vscode/
.idea/
*.swp
*.swo

# 環境相關
.env.local
.env.*.local
```

---

## 行尾符號處理

### .gitattributes 設定 (推薦)

在專案根目錄建立 `.gitattributes` 文件,明確定義每種文件的行尾符號:

```gitattributes
# 自動偵測文字檔並標準化為 LF
* text=auto

# 明確指定特定文件類型使用 LF
*.sh text eol=lf
*.py text eol=lf
*.js text eol=lf
*.ts text eol=lf
*.json text eol=lf
*.md text eol=lf
*.yml text eol=lf
*.yaml text eol=lf

# Windows 批次檔必須使用 CRLF
*.bat text eol=crlf
*.cmd text eol=crlf
*.ps1 text eol=crlf

# 二進位檔不要處理
*.png binary
*.jpg binary
*.jpeg binary
*.gif binary
*.ico binary
*.mov binary
*.mp4 binary
*.mp3 binary
*.pdf binary
*.ttf binary
*.woff binary
*.woff2 binary
*.eot binary
```

### 修正已存在的行尾符號問題

```bash
# 1. 確保 .gitattributes 已設定
# 2. 重新標準化所有文件
git add --renormalize .

# 3. 提交變更
git commit -m "chore: 標準化行尾符號"
```

---

## 文件編碼

### UTF-8 設定

**VSCode 設定** (`.vscode/settings.json`):

```json
{
  "files.encoding": "utf8",
  "files.eol": "\n",
  "files.insertFinalNewline": true,
  "files.trimTrailingWhitespace": true
}
```

**Git 設定**:

```bash
# 設定 commit message 編碼
git config --global i18n.commitencoding utf-8

# 設定 log 輸出編碼
git config --global i18n.logoutputencoding utf-8
```

**Windows PowerShell 設定**:

```powershell
# 在 PowerShell 配置文件中加入
[Console]::OutputEncoding = [System.Text.Encoding]::UTF8
$OutputEncoding = [System.Text.Encoding]::UTF8
```

---

## VS Code 進階設定

### 1. 隱藏系統產生的垃圾檔

跨平台開發時，Mac 會產生 `.DS_Store`，Windows 會有 `Thumbs.db`，這些檔案容易不小心被 commit 進去。

```json
{
  "files.exclude": {
    "**/.git": true,
    "**/.svn": true,
    "**/.hg": true,
    "**/CVS": true,
    "**/.DS_Store": true,
    "**/tmp": true,
    "**/node_modules": true,
    "**/bower_components": true,
    "**/dist": true,
    "**/Thumbs.db": true,
    "**/desktop.ini": true
  }
}
```

### 2. 視覺輔助

讓你肉眼直接抓出「全形空白」或「多餘的 Tab/Space 混用」等隱形錯誤。

```json
{
  "editor.renderWhitespace": "boundary",
  "editor.renderControlCharacters": true,
  "editor.guides.bracketPairs": true,
  "editor.bracketPairColorization.enabled": true
}
```

### 3. 自動化整理

存檔時自動排版，確保程式碼風格一致。

```json
{
  "editor.formatOnSave": true,
  "editor.codeActionsOnSave": {
    "source.organizeImports": "always"
  }
}
```

### 4. 效能優化

避免 VS Code 因過度掃描大型資料夾而變慢。

```json
{
  "files.watcherExclude": {
    "**/.git/objects/**": true,
    "**/.git/subtree-cache/**": true,
    "**/node_modules/**": true,
    "**/vendor/**": true,
    "**/build/**": true,
    "**/tmp/**": true,
    "**/bower_components/**": true,
    "**/dist/**": true,
    "**/logs/**": true
  }
}
```

### 完整推薦設定

結合以上設定的完整 `.vscode/settings.json`：

```json
{
  "files.encoding": "utf8",
  "files.eol": "\n",
  "files.insertFinalNewline": true,
  "files.trimTrailingWhitespace": true,

  "files.exclude": {
    "**/.git": true,
    "**/.svn": true,
    "**/.hg": true,
    "**/CVS": true,
    "**/.DS_Store": true,
    "**/tmp": true,
    "**/node_modules": true,
    "**/bower_components": true,
    "**/dist": true,
    "**/Thumbs.db": true,
    "**/desktop.ini": true
  },

  "files.watcherExclude": {
    "**/.git/objects/**": true,
    "**/.git/subtree-cache/**": true,
    "**/node_modules/**": true,
    "**/vendor/**": true,
    "**/build/**": true,
    "**/tmp/**": true,
    "**/bower_components/**": true,
    "**/dist/**": true,
    "**/logs/**": true
  },

  "editor.renderWhitespace": "boundary",
  "editor.renderControlCharacters": true,
  "editor.guides.bracketPairs": true,
  "editor.bracketPairColorization.enabled": true,
  "editor.formatOnSave": true,
  "editor.codeActionsOnSave": {
    "source.organizeImports": "always"
  }
}
```

---

## 路徑處理

### 路徑分隔符

**問題**: Windows 使用反斜線 (`\`),Unix/Linux 使用斜線 (`/`)。

**Python 解決方案**:

```python
import os
from pathlib import Path

# 使用 pathlib (推薦)
path = Path("data") / "file.txt"

# 使用 os.path.join
path = os.path.join("data", "file.txt")

# 標準化路徑
normalized = os.path.normpath(path)
```

**Node.js 解決方案**:

```javascript
const path = require('path');

// 使用 path.join
const filePath = path.join('data', 'file.txt');

// 使用 path.resolve
const absolutePath = path.resolve('data', 'file.txt');

// 標準化路徑
const normalized = path.normalize(filePath);
```

### 家目錄路徑

```python
# Python
from pathlib import Path
home = Path.home()

# 或使用 os
import os
home = os.path.expanduser("~")
```

```javascript
// Node.js
const os = require('os');
const home = os.homedir();
```

### WSL 路徑轉換

```bash
# Windows 路徑轉 WSL 路徑
wslpath "C:\Users\username\project"
# 輸出: /mnt/c/Users/username/project

# WSL 路徑轉 Windows 路徑
wslpath -w /mnt/c/Users/username/project
# 輸出: C:\Users\username\project
```

---

## 環境變數

### 跨平台環境變數設定

**使用 .env 文件** (推薦):

```bash
# .env
DATABASE_URL=postgresql://localhost/mydb
API_KEY=your-api-key
DEBUG=true
```

**Python - python-dotenv**:

```python
from dotenv import load_dotenv
import os

load_dotenv()  # 載入 .env 文件

db_url = os.getenv("DATABASE_URL")
```

**Node.js - dotenv**:

```javascript
require('dotenv').config();

const dbUrl = process.env.DATABASE_URL;
```

### 環境變數命名規範

```bash
# ✅ 推薦: 使用大寫和底線
DATABASE_URL=value
API_KEY=value

# ❌ 避免: 使用特殊字符或空格
database-url=value  # 某些 shell 可能不支援
Database Url=value  # 空格會導致問題
```

---

## 腳本執行

### Shell 腳本

**設定 Shebang**:

```bash
#!/usr/bin/env bash
# 使用 env 可以在不同系統找到 bash

set -e  # 遇到錯誤立即退出
set -u  # 使用未定義變數時報錯
```

**執行權限**:

```bash
# Linux/macOS/WSL
chmod +x script.sh
./script.sh

# Windows (Git Bash)
bash script.sh
```

### Python 腳本

**Shebang 設定**:

```python
#!/usr/bin/env python3
# 使用 env 可以找到正確的 Python 版本
```

**跨平台執行**:

```bash
# 明確指定 Python
python script.py         # Windows 可能需要
python3 script.py        # Linux/macOS 推薦

# 使用虛擬環境 (跨平台)
python -m venv venv

# 啟動虛擬環境
# Windows:
venv\Scripts\activate
# Linux/macOS:
source venv/bin/activate
```

### npm scripts

**package.json 設定**:

```json
{
  "scripts": {
    "clean": "rm -rf dist",           // ❌ Unix only
    "clean": "rimraf dist",           // ✅ 跨平台 (需安裝 rimraf)

    "build": "SET NODE_ENV=prod && node build.js",  // ❌ Windows only
    "build": "cross-env NODE_ENV=prod node build.js" // ✅ 跨平台
  }
}
```

**跨平台工具**:

```bash
# 安裝跨平台工具
npm install --save-dev cross-env   # 環境變數
npm install --save-dev rimraf      # 刪除文件/目錄
npm install --save-dev copyfiles   # 複製文件
npm install --save-dev mkdirp      # 建立目錄
```

---

## Python 開發

### 虛擬環境

**建立與啟動**:

```bash
# 建立虛擬環境
python -m venv venv

# Windows 啟動
venv\Scripts\activate

# Linux/macOS 啟動
source venv/bin/activate

# 停用 (所有平台)
deactivate
```

### requirements.txt

```bash
# 生成
pip freeze > requirements.txt

# 安裝
pip install -r requirements.txt
```

### 使用 pyproject.toml (現代做法)

```toml
[project]
name = "myproject"
version = "0.1.0"
requires-python = ">=3.8"
dependencies = [
    "requests>=2.28.0",
    "numpy>=1.24.0"
]

[project.optional-dependencies]
dev = [
    "pytest>=7.0.0",
    "black>=22.0.0"
]
```

### 路徑處理

```python
from pathlib import Path

# 取得腳本所在目錄
script_dir = Path(__file__).parent

# 取得專案根目錄
project_root = Path(__file__).parent.parent

# 建立跨平台路徑
data_file = project_root / "data" / "input.txt"
```

---

## Node.js 開發

### 版本管理

**使用 .nvmrc**:

```bash
# .nvmrc
18.17.0
```

```bash
# 使用指定版本
nvm use

# 安裝指定版本
nvm install
```

### package.json engines

```json
{
  "engines": {
    "node": ">=18.0.0",
    "npm": ">=9.0.0"
  }
}
```

### 路徑處理

```javascript
const path = require('path');
const { fileURLToPath } = require('url');

// CommonJS
const __dirname = __dirname;

// ES Modules
const __filename = fileURLToPath(import.meta.url);
const __dirname = path.dirname(__filename);

// 建立跨平台路徑
const dataPath = path.join(__dirname, 'data', 'input.json');
```

---

## 最佳實踐

### 1. 容器化開發環境

**使用 Docker**:

```dockerfile
# Dockerfile
FROM node:18-alpine

WORKDIR /app
COPY package*.json ./
RUN npm ci

COPY . .

CMD ["npm", "start"]
```

**使用 Dev Containers** (VSCode):

```json
// .devcontainer/devcontainer.json
{
  "name": "Project Dev Container",
  "image": "mcr.microsoft.com/devcontainers/python:3.11",
  "features": {
    "ghcr.io/devcontainers/features/node:1": {}
  },
  "postCreateCommand": "pip install -r requirements.txt"
}
```

### 2. CI/CD 配置

**GitHub Actions 範例**:

```yaml
# .github/workflows/test.yml
name: Test

on: [push, pull_request]

jobs:
  test:
    runs-on: ${{ matrix.os }}
    strategy:
      matrix:
        os: [ubuntu-latest, windows-latest, macos-latest]
        python-version: ['3.8', '3.9', '3.10', '3.11']

    steps:
    - uses: actions/checkout@v3

    - name: Set up Python
      uses: actions/setup-python@v4
      with:
        python-version: ${{ matrix.python-version }}

    - name: Install dependencies
      run: |
        python -m pip install --upgrade pip
        pip install -r requirements.txt

    - name: Run tests
      run: pytest
```

### 3. EditorConfig

EditorConfig 讓不同編輯器的協作者也能遵守相同的程式碼風格規範。

**安裝擴充套件**

VS Code 本身**不會**直接讀取 `.editorconfig` 檔案。你需要安裝官方擴充套件：

- 名稱：**EditorConfig for VS Code**
- 安裝後，VS Code 就會優先採用 `.editorconfig` 的規則

**建立 .editorconfig**:

在專案**根目錄**建立 `.editorconfig` 檔案：

```ini
# .editorconfig
# 這是最頂層的設定檔，告訴編輯器停止往上層目錄尋找
root = true

# [*] 代表這些規則套用到「所有檔案」
[*]
charset = utf-8
end_of_line = lf
insert_final_newline = true
trim_trailing_whitespace = true
indent_style = space
indent_size = 4

# 針對特定檔案類型覆寫設定
[*.{js,ts,json,yml,yaml}]
indent_size = 2

[*.md]
trim_trailing_whitespace = false

[Makefile]
indent_style = tab
```

**說明**:
- `root = true`: 告訴編輯器這是最頂層設定，不再往上層目錄尋找
- `[*]`: 套用到所有檔案；如需針對特定檔案類型設定，可新增區塊（如 `[*.json]`）覆寫
- 此設定與 `.gitattributes` 搭配使用，能更徹底解決跨平台換行問題

### 4. 文件命名規範

```bash
# ✅ 推薦: 使用小寫和連字號
my-project-file.txt
user-profile.json

# ⚠️ 避免: 空格和特殊字符
My Project File.txt  # 空格在某些 shell 會有問題
user_profile.json    # 底線可以,但連字號更通用

# ❌ 避免: 大小寫混用 (Windows 不區分)
MyFile.txt
myfile.txt  # 在 Windows 會被視為同一個文件
```

### 5. 符號連結處理

```bash
# Git 設定處理符號連結
git config --global core.symlinks true  # Windows 需要管理員權限

# 檢查符號連結支援
git config core.symlinks
```

---

## 檢查清單

在設定新的開發環境時,請確認以下項目:

- [ ] Git 設定
  - [ ] `core.filemode false` (Windows)
  - [ ] `core.autocrlf` 設定正確
  - [ ] `core.longpaths true` (Windows)
  - [ ] `.gitattributes` 已配置
  - [ ] `.gitignore` 已配置

- [ ] 編輯器設定
  - [ ] UTF-8 編碼
  - [ ] LF 行尾符號
  - [ ] `.editorconfig` 已配置
  - [ ] `.vscode/settings.json` 已配置

- [ ] 腳本執行
  - [ ] Shell 腳本有正確的 shebang
  - [ ] Python 腳本有執行權限
  - [ ] npm scripts 使用跨平台工具

- [ ] 路徑處理
  - [ ] 使用 `path.join()` 或 `Path()` 而非手動拼接
  - [ ] 避免硬編碼絕對路徑

- [ ] 環境變數
  - [ ] 使用 `.env` 文件
  - [ ] `.env` 已加入 `.gitignore`
  - [ ] 環境變數使用大寫命名

---

## 參考資源

- [Git 官方文檔 - gitattributes](https://git-scm.com/docs/gitattributes)
- [EditorConfig 官網](https://editorconfig.org/)
- [Node.js path 模組](https://nodejs.org/api/path.html)
- [Python pathlib](https://docs.python.org/3/library/pathlib.html)
- [WSL 文檔](https://docs.microsoft.com/en-us/windows/wsl/)

---

## 版本歷史

- **2026-01-26**: 初版發布
