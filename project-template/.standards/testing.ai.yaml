# Testing Standards - AI Optimized (v2 Dual-Layer)
# Source: core/testing-standards.md

standard:
  id: testing
  name: Testing Standards
  description: Testing pyramid and recommended coverage ratios with framework options
  guidelines:
    - "Follow 70/20/10 testing pyramid"
    - "Use FIRST principles for unit tests"
    - "Structure tests with Arrange-Act-Assert"
    - "Use meaningful test names"

  meta:
    version: "2.0.0"
    updated: "2026-02-04"
    source: core/testing-standards.md
    guide: skills/testing-guide/testing-theory.md
    description: Testing pyramid and recommended coverage ratios with framework options

  framework_options:
    decision_point: Select testing framework based on project type
    choices:
      - id: istqb-framework
        file: options/testing/istqb-framework.ai.yaml
        best_for: Enterprise projects, certification needs, formal QA processes
      - id: industry-pyramid
        file: options/testing/industry-pyramid.ai.yaml
        best_for: Agile development, CI/CD optimization, rapid iteration

  pyramid:
    ratio: "70/20/10"
    note: "Industry standard ratio. ISTQB framework uses 4 levels without fixed ratios."
    levels:
      - name: Unit Tests (UT)
        percentage: 70
        scope: Single function/method
        speed: Very fast (<100ms)
      - name: Integration Tests (IT/SIT)
        percentage: 20
        scope: Multiple components
        speed: Fast (<1s)
        note: "IT (Agile/DevOps) or SIT (Enterprise/ISTQB) - both refer to integration testing"
      - name: E2E Tests
        percentage: 10
        scope: User flows / System testing
        speed: Slow (>10s)

  options:
    testing_framework:
      description: Choose testing framework approach
      multiSelect: false
      choices:
        - id: istqb-framework
          file: options/testing/istqb-framework.ai.yaml
        - id: industry-pyramid
          file: options/testing/industry-pyramid.ai.yaml
    test_level:
      description: Choose test levels to implement
      multiSelect: true
      choices:
        - id: unit-testing
          file: options/testing/unit-testing.ai.yaml
        - id: integration-testing
          file: options/testing/integration-testing.ai.yaml
        - id: system-testing
          file: options/testing/system-testing.ai.yaml
        - id: e2e-testing
          file: options/testing/e2e-testing.ai.yaml
        - id: security-testing
          file: options/testing/security-testing.ai.yaml
          best_for: Applications handling sensitive data, security-critical systems
        - id: performance-testing
          file: options/testing/performance-testing.ai.yaml
          best_for: High-traffic applications, real-time systems, APIs
        - id: contract-testing
          file: options/testing/contract-testing.ai.yaml
          best_for: Microservices, API integrations, distributed systems

  rules:
    - id: follow-pyramid
      trigger: planning test strategy
      instruction: Follow 70/20/7/3 ratio for UT/IT/ST/E2E
      priority: required
    - id: first-principles
      trigger: writing tests
      instruction: Follow FIRST principles (Fast, Independent, Repeatable, Self-validating, Timely)
      priority: required
    - id: arrange-act-assert
      trigger: structuring test
      instruction: Use Arrange-Act-Assert pattern
      priority: required
    - id: meaningful-names
      trigger: naming tests
      instruction: Use descriptive test names that explain what is being tested
      priority: required
      examples:
        good:
          - "should_return_user_when_valid_id_provided"
          - "test_login_fails_with_invalid_credentials"
        bad:
          - "test1"
          - "testLogin"
    - id: test-boundaries
      trigger: choosing what to test
      instruction: Focus on boundary conditions and edge cases
      priority: recommended
    - id: avoid-test-doubles-overuse
      trigger: using mocks/stubs
      instruction: Use test doubles sparingly; prefer real implementations when fast enough
      priority: recommended

physical_spec:
  type: custom_script
  validator:
    command: >
      test -f vitest.config.ts || test -f vitest.config.js || test -f jest.config.js || grep -q '"test":' package.json
    rule: "test_runner_configured"