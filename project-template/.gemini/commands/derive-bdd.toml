# derive-bdd command - converted from UDS
description = "Derive BDD Gherkin scenarios from approved SDD specification"

prompt = """

## Arguments
User provided: {{args}}

# Derive BDD Scenarios from Specification | 從規格推演 BDD 場景

Transform approved SDD specification's Acceptance Criteria into BDD Gherkin scenarios.

將已批准的 SDD 規格驗收條件轉換為 BDD Gherkin 場景。

## Workflow | 工作流程

```
┌─────────────────┐    ┌─────────────────┐    ┌─────────────────┐
│  Read SPEC      │───▶│ Parse AC        │───▶│ Generate        │
│  讀取規格        │    │ 解析驗收條件     │    │ Gherkin         │
└─────────────────┘    └─────────────────┘    │ 生成 Gherkin    │
                                              └────────┬────────┘
                                                       │
                                                       ▼
                       ┌─────────────────┐    ┌─────────────────┐
                       │  Human Review   │◀───│ Write .feature  │
                       │  人類審查        │    │ 寫入 .feature   │
                       └─────────────────┘    └─────────────────┘
```

## Anti-Hallucination Compliance | 反幻覺合規

**CRITICAL**: Output MUST strictly follow 1:1 AC mapping.

**關鍵**：輸出必須嚴格遵循 1:1 AC 對應。

```
Input:  SPEC with N Acceptance Criteria
Output: Exactly N Gherkin Scenarios

If output count ≠ input count → VIOLATION
```

## Steps | 步驟

### 1. Read Specification | 讀取規格

Read the approved specification file and identify:
- SPEC ID (e.g., SPEC-001)
- Feature title and summary
- Acceptance Criteria section

讀取已批准的規格文件並識別：
- 規格 ID（例如 SPEC-001）
- 功能標題和摘要
- 驗收條件章節

### 2. Parse Acceptance Criteria | 解析驗收條件

Extract AC in one of these formats:

#### Given-When-Then Format (Direct)
```markdown
### AC-1: User Login
**Given** a registered user
**When** the user submits valid credentials
**Then** the user is logged in
```

#### Bullet Format (Transform)
```markdown
### AC-1: User Login
- User can login with email and password
- Login redirects to dashboard on success
```

### 3. Generate Gherkin | 生成 Gherkin

Transform each AC to a Scenario:

將每個 AC 轉換為 Scenario：

**Transformation Rules | 轉換規則**:

| AC Pattern | Gherkin Step |
|------------|--------------|
| Condition/state | Given |
| User action | When |
| System response | Then |
| Additional outcome | And |

### 4. Apply Source Attribution | 套用來源標註

Every scenario MUST include:
- `@SPEC-XXX` tag at feature level
- `@AC-N` tag at scenario level
- Source comment with file reference

## Output Format | 輸出格式

```gherkin
# Generated from: specs/SPEC-001.md
# Generator: /derive-bdd v1.0.0
# Generated at: [timestamp]

@SPEC-001
Feature: [Title from SPEC]
  [Summary from SPEC]

  @AC-1 @happy-path
  Scenario: [AC-1 Title]
    # [Source] From SPEC-001 AC-1
    Given [precondition]
    When [action]
    Then [expected result]

  @AC-2 @error-handling
  Scenario: [AC-2 Title]
    # [Source] From SPEC-001 AC-2
    Given [precondition]
    When [action]
    Then [expected result]
```

## Parameters | 參數

| Parameter | Description | Default |
|-----------|-------------|---------|
| `--output-dir` | Output directory | `./features` |
| `--dry-run` | Preview without creating files | `false` |

## Usage Examples | 使用範例

```bash
# Basic usage
/derive-bdd specs/SPEC-001.md

# Specify output directory
/derive-bdd specs/SPEC-001.md --output-dir ./features/auth

# Preview without creating file
/derive-bdd specs/SPEC-001.md --dry-run
```

## Limitations | 限制

This command **CANNOT**:

此命令**無法**：

- Generate scenarios beyond AC count
- Implement step definitions
- Infer requirements not in specification
- Modify existing feature files

## Reference | 參考

- Full skill guide: [forward-derivation](../forward-derivation/SKILL.md)
- Core standard: [forward-derivation-standards.md](../../../core/forward-derivation-standards.md)
- BDD format: [behavior-driven-development.md](../../../core/behavior-driven-development.md)
"""